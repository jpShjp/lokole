(this["webpackJsonpopwen-statuspage"]=this["webpackJsonpopwen-statuspage"]||[]).push([[0],{181:function(e,t,n){e.exports=n(388)},388:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(8),s=n.n(i),c=(n(186),n(132)),l=(n(188),n(133)),o=n(100),u=n(29),p=n(30),m=n(32),g=n(31),h=n(33),d=(n(190),n(175)),v=(n(389),n(174)),f=(n(103),n(7));var b=function(e){return r.a.createElement(f.a,{type:e.icon,onClick:e.onClick})},E=(n(73),n(46)),k=(n(241),n(177)),y=(n(243),n(42)),O=(n(246),n(71)),S=n(18),x=n.n(S),j=n(26),_=n(57),w=n.n(_),U=w.a.create({baseURL:"https://api.github.com"}),C=function(e){return"".concat(e," seconds")},I=function(e){return e.replace(/[^0-9]/g,"")},A="rgba(0, 0, 0, .25)",F=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r))))._validateGithubAccessToken=function(){var e=Object(j.a)(x.a.mark((function e(t,a,r){var i,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.props.form,a){e.next=4;break}return i.setFieldsValue({githubUsername:void 0,githubAvatarUrl:void 0},r),e.abrupt("return");case 4:return e.prev=4,e.next=7,U.get("/user",{headers:{Authorization:"Token ".concat(a)}});case 7:s=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),r(e.t0.response.data.message),e.abrupt("return");case 14:i.setFieldsValue({githubUsername:s.data.login,githubAvatarUrl:s.data.avatar_url},r);case 15:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t,n,a){return e.apply(this,arguments)}}(),n.handleSubmit=function(e){var t=n.props,a=t.form,r=t.onChange;e.preventDefault(),a.validateFields((function(e,t){e||r(Object(o.a)({},t,{updatedAt:"".concat(new Date)}))}))},n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props.form,t=this.props.initialValue,n=t.serverEndpoint,a=t.githubAccessToken,i=t.githubUsername,s=t.githubAvatarUrl,c=t.pingIntervalSeconds;return r.a.createElement(y.a,{onSubmit:this.handleSubmit},r.a.createElement(y.a.Item,{label:"Server endpoint"},e.getFieldDecorator("serverEndpoint",{rules:[{required:!0,message:"Please input the endpoint URL of the Lokole server"}],initialValue:n})(r.a.createElement(O.a,{prefix:r.a.createElement(f.a,{type:"api",style:{color:A}}),placeholder:"http://localhost:8080"}))),r.a.createElement(y.a.Item,{label:"Github access token"},e.getFieldDecorator("githubAccessToken",{rules:[{validator:this._validateGithubAccessToken}],initialValue:a})(r.a.createElement(O.a.Password,{prefix:r.a.createElement(f.a,{type:"github",style:{color:A}}),placeholder:"1234567abcdefgh"}))),r.a.createElement(y.a.Item,{style:{display:"none"}},e.getFieldDecorator("githubUsername",{initialValue:i})(r.a.createElement(O.a,{readOnly:!0,hidden:!0}))),r.a.createElement(y.a.Item,{style:{display:"none"}},e.getFieldDecorator("githubAvatarUrl",{initialValue:s})(r.a.createElement(O.a,{readOnly:!0,hidden:!0}))),r.a.createElement(y.a.Item,{label:"Ping interval"},e.getFieldDecorator("pingIntervalSeconds",{rules:[{required:!0,message:"Please input the ping interval in seconds"}],initialValue:c})(r.a.createElement(k.a,{style:{width:"100%"},placeholder:"10 seconds",formatter:C,parser:I,min:1,max:60}))),r.a.createElement(y.a.Item,null,r.a.createElement(E.a,{type:"primary",htmlType:"submit"},"Save settings")))}}]),t}(r.a.Component),P=y.a.create({name:"settings"})(F),D=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={isSettingsVisible:!1},n._onOpenSettings=function(){return n.setState({isSettingsVisible:!0})},n._onCloseSettings=function(){return n.setState({isSettingsVisible:!1})},n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.state.isSettingsVisible,t=this.props,n=t.onChangeSettings,a=t.settings,i=r.a.createElement(P,{initialValue:a,onChange:n});return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{title:"Lokole Status Dashboard",avatar:null!=a.githubAvatarUrl?{src:a.githubAvatarUrl}:{icon:"user"},extra:[r.a.createElement(b,{onClick:this._onOpenSettings,icon:"setting",key:"setting"})]}),r.a.createElement(d.a,{title:"Settings",visible:e,onClose:this._onCloseSettings},i))}}]),t}(r.a.PureComponent),N=(n(125),n(47)),T=(n(128),n(59)),V=(n(162),n(97)),L=(n(390),n(171)),M=(n(372),n(178));var G=function(e){var t,n=e.message,a=e.exception;t=a.response&&a.response.data?"string"===typeof a.response.data?a.response.data:a.response.data.detail:a.message,M.a.error({message:n,description:t})};var J=function(e){return r.a.createElement(T.a,Object.assign({grid:{gutter:16,xs:1,md:4,lg:6},itemLayout:"vertical"},e))},R=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={isDeleting:!1,isFetchingPendingEmails:!1,numPendingEmails:null,isFetchingNumberOfUsers:!1,numUsers:null},n._onClickDelete=Object(j.a)(x.a.mark((function e(){var t,a,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props,a=t.domain,r=t.onDelete,!n.state.isDeleting){e.next=4;break}return e.abrupt("return");case 4:return n.setState({isDeleting:!0}),e.next=7,r(a);case 7:n.setState({isDeleting:!1});case 8:case"end":return e.stop()}}),e)}))),n._onClickFetchPendingEmails=Object(j.a)(x.a.mark((function e(){var t,a,r,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props,a=t.domain,r=t.fetchNumPendingEmails,!n.state.isFetchingPendingEmails){e.next=4;break}return e.abrupt("return");case 4:return n.setState({isFetchingPendingEmails:!0}),e.next=7,r(a);case 7:i=e.sent,n.setState({isFetchingPendingEmails:!1,numPendingEmails:i});case 9:case"end":return e.stop()}}),e)}))),n._onClickFetchNumberOfUsers=Object(j.a)(x.a.mark((function e(){var t,a,r,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props,a=t.domain,r=t.fetchNumUsers,!n.state.isFetchingNumberOfUsers){e.next=4;break}return e.abrupt("return");case 4:return n.setState({isFetchingNumberOfUsers:!0}),e.next=7,r(a);case 7:i=e.sent,n.setState({isFetchingNumberOfUsers:!1,numUsers:i});case 9:case"end":return e.stop()}}),e)}))),n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props.domain,t=this.state,n=t.isDeleting,a=t.isFetchingPendingEmails,i=t.numPendingEmails,s=t.isFetchingNumberOfUsers,c=t.numUsers;return r.a.createElement(V.a,{actions:[r.a.createElement(L.a,{title:r.a.createElement("span",null,"This will delete client ",r.a.createElement("em",null,e),".",r.a.createElement("br",null),"Are you sure?"),cancelText:"No, cancel.",okText:"Yes, delete!",onConfirm:this._onClickDelete,disabled:n},r.a.createElement(b,{icon:n?"loading":"delete"})),r.a.createElement("div",null,r.a.createElement(b,{icon:a?"loading":"mail",onClick:this._onClickFetchPendingEmails}),null!=this.state.numPendingEmails&&r.a.createElement("span",null,"\xa0",i)),r.a.createElement("div",null,r.a.createElement(b,{icon:s?"loading":"user",onClick:this._onClickFetchNumberOfUsers}),null!=this.state.numUsers&&r.a.createElement("span",null,"\xa0",c))],style:{textDecoration:n?"line-through":void 0}},e)}}]),t}(r.a.Component),q=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(i)))).state={clients:[],isLoading:!0},n._fetchClients=Object(j.a)(x.a.mark((function e(){var t,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.clients,e.prev=1,e.next=4,n._client.get("/api/email/register/");case 4:a=e.sent,t=a.data.clients.sort(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),G({message:"Unable to fetch clients",exception:e.t0});case 11:n.setState({clients:t,isLoading:!1});case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),n._deleteClient=function(){var e=Object(j.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._client.delete("/api/email/register/".concat(t)).then(n._fetchClients);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),G({message:"Unable to delete client ".concat(t),exception:e.t0});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),n._fetchNumPendingEmails=function(){var e=Object(j.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._client.get("/api/email/metrics/pending/".concat(t));case 3:return a=e.sent,e.abrupt("return",a.data.pending_emails);case 7:return e.prev=7,e.t0=e.catch(0),G({message:"Unable to fetch pending emails for client ".concat(t),exception:e.t0}),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),n._fetchNumUsers=function(){var e=Object(j.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._client.get("/api/email/metrics/users/".concat(t));case 3:return a=e.sent,e.abrupt("return",a.data.users);case 7:return e.prev=7,e.t0=e.catch(0),G({message:"Unable to fetch number of users for client ".concat(t),exception:e.t0}),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),n._renderListItem=function(e){var t=e.domain;return r.a.createElement(T.a.Item,{key:t},r.a.createElement(R,{domain:t,onDelete:n._deleteClient,fetchNumPendingEmails:n._fetchNumPendingEmails,fetchNumUsers:n._fetchNumUsers}))},n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this._isEnabled&&this._fetchClients()}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.clients;return this._isEnabled?r.a.createElement(J,{loading:t,dataSource:n,renderItem:this._renderListItem}):r.a.createElement(N.a,{description:"Add Github access token in settings to view clients."})}},{key:"_client",get:function(){var e=this.props.settings,t=e.serverEndpoint,n=e.githubAccessToken;return w.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(n)}})}},{key:"_isEnabled",get:function(){return this.props.settings.githubAccessToken}}]),t}(r.a.Component),z=(n(375),n(176)),B="#3f8600",W="#cf1322",H=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={pingTimeMillis:void 0,pingSuccess:void 0},n._pingInterval=void 0,n._onPing=Object(j.a)(x.a.mark((function e(){var t,a,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.serverEndpoint,a=(new Date).getTime(),e.prev=2,e.next=5,w.a.get(t);case 5:r=!0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),G({message:"Unable to ping server",exception:e.t0}),r=!1;case 12:n.setState({pingTimeMillis:(new Date).getTime()-a,pingSuccess:r});case 13:case"end":return e.stop()}}),e,null,[[2,8]])}))),n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(j.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.pingIntervalSeconds,e.next=3,this._onPing();case 3:this._pingInterval=setInterval(this._onPing,1e3*t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){null!=this._pingInterval&&clearInterval(this._pingInterval)}},{key:"render",value:function(){var e=this.props.title,t=this.state,n=t.pingSuccess,a=t.pingTimeMillis;return r.a.createElement(T.a.Item,{key:e},r.a.createElement(V.a,null,r.a.createElement(z.a,{title:e,value:a,suffix:"ms",prefix:r.a.createElement(f.a,{type:n?"check":"warning"}),valueStyle:{color:n?B:W}})))}}]),t}(r.a.Component);var Y=function(e){var t=e.settings,n=t.serverEndpoint,a=t.pingIntervalSeconds;return r.a.createElement(J,null,r.a.createElement(H,{title:"Server ping",pingIntervalSeconds:a,serverEndpoint:"".concat(n,"/healthcheck/ping")}),r.a.createElement(H,{title:"Webapp ping",pingIntervalSeconds:a,serverEndpoint:"".concat(n,"/web/healthcheck/ping")}))},K={pingIntervalSeconds:5,githubAccessToken:void 0,githubUsername:void 0,serverEndpoint:"https://mailserver.lokole.ca"},Q=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={settings:Object(o.a)({},K,{},JSON.parse(localStorage.getItem("settings")||"{}"))},n._onChangeSettings=function(e){localStorage.setItem("settings",JSON.stringify(e)),n.setState({settings:e})},n}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.state.settings;return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,{style:{minHeight:"100vh"}},r.a.createElement(D,{settings:e,onChangeSettings:this._onChangeSettings}),r.a.createElement(c.a.Content,{style:{padding:"0 50px"}},r.a.createElement(l.a,null,"Stats"),r.a.createElement(Y,{settings:e,key:"stats-".concat(e.updatedAt)}),r.a.createElement(l.a,null,"Clients"),r.a.createElement(q,{settings:e,key:"clients-".concat(e.updatedAt)}))))}}]),t}(r.a.Component);s.a.render(r.a.createElement(Q,null),document.getElementById("root"))}},[[181,1,2]]]);
//# sourceMappingURL=main.8dff751d.chunk.js.map